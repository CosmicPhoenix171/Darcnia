# Darcnia Campaign - Version History

## Current Version: 1.28

### üéâ Auto-Versioning System Active!

**No manual updates needed!** Versions are now generated automatically from Git commits.

- **Format**: `v1.26-a3f2b1c` (base version + commit hash)
- **Updated by**: GitHub Actions on every push to `main`
- **See**: [AUTO-VERSIONING.md](AUTO-VERSIONING.md) for full documentation

### How to Update Version (Automatic)

Just commit and push - that's it! üöÄ

```bash
git add .
git commit -m "Your changes"
git push
```

The version will automatically update to include your commit hash.

### Legacy Manual Updates (v1.21-v1.25 only)

<details>
<summary>Old manual process (no longer needed)</summary>

When making changes, increment the version number and update it in these locations:

1. **web/index.html** (3 places)
2. **web/js/pricing.js** (version log)
3. **This file (VERSION.md)**

</details>

---

## Changelog

### v1.28 - November 4, 2025
**UI Enhancement:**
- ‚ú® **Improved price display with color-coded percentage changes**
- Removed strikethrough of old prices
- Now shows percentage change next to final price
- üî¥ Red (+X.X%) for price increases
- üü¢ Green (-X.X%) for discounts
- Example: "2 gp, 8 cp (+4.0%)" or "5 sp, 2 cp (-3.5%)"
- Cleaner, more intuitive price display

**Technical Changes:**
- Calculate percentage: `(finalCopper - baseCopper) / baseCopper * 100`
- Dynamic color: Red (#ff4444) for increases, Green (#44ff44) for discounts
- Percentage badge displays with ¬± sign

### v1.27 - November 4, 2025
**Bug Fix:**
- üêõ **Fixed: Documentation text showing as market items** 
- The "Dynamic Pricing System" section was being parsed as shop items
- Items like "Step: 2% per offset point" were showing with "1 cp" prices
- Solution: Parser now skips documentation sections (## üìä emoji headers)
- Only actual shop sections (## without emojis) are parsed as inventory

**Technical Changes:**
- Added `inDocsSection` flag to `parseBluebrickMarketMarkdown()`
- Documentation sections are now properly ignored
- Cleaner market display without junk entries

### v1.26 - November 4, 2025
**AUTO-VERSIONING SYSTEM:**
- ‚ú® **Implemented automatic version generation from Git commits**
- ü§ñ Created GitHub Action that auto-updates `version.js` on every push
- üì¶ Version format: `v1.26-<commit-hash>` (e.g., "v1.26-a3f2b1c")
- üîç Version badge now shows build details on hover (commit hash + timestamp)
- üìù Console logs include version, commit, and build time
- üóëÔ∏è Removed manual version update process (no more updating 5 files!)
- üìö Added AUTO-VERSIONING.md documentation

**Technical Changes:**
- Created `web/js/version.js` (auto-generated by GitHub Actions)
- Created `.github/workflows/update-version.yml` workflow
- Updated `index.html` to load version.js and removed cache-busting query params
- Updated `app.js` with `updateVersionDisplay()` function
- Updated `pricing.js` to read version from `window.APP_VERSION`

**Benefits:**
- No more forgetting to update version numbers
- Perfect cache-busting (unique version per commit)
- Full traceability (know exactly which commit is deployed)
- Automatic deployment version tracking

### v1.25 - November 4, 2025
**CRITICAL FIX:**
- üêõ **FIXED: All prices showing "0 cp"** - Issue was function name collision
- Root cause: Two `formatPrice()` functions existed - one in `pricing.js` (takes object) and one in `app.js` (takes 3 parameters)
- Solution: Changed `calculateFinalPrice()` to call `formatPrice(priceObj.gp, priceObj.sp, priceObj.cp)` with three separate parameters
- This matches the `app.js` function signature which was being called instead of the `pricing.js` version

**Debugging Journey (v1.22-v1.24):**
- v1.22: Added debug logs to `formatPrice()` in pricing.js
- v1.23: Added debug logs to `copperToPrice()` - proved it worked correctly
- v1.24: Added inline debug logs in `calculateFinalPrice()` - revealed formatPrice() returned "0 cp"
- v1.25: Discovered function collision, fixed parameter passing

### v1.21 - November 4, 2025
**Features:**
- ‚ú® Added version display system in bottom-left corner
- ‚ú® Added character level field to character sheet
- ‚ú® Character level syncs with Firebase
- ‚ú® Market access now based on character level + item rarity
- ‚ú® Cart validation checks level requirements before adding items
- üêõ Fixed currency conversion bug in pricing system (copperToPrice function)
- üêõ Fixed price display showing "0 cp" for all items

**Technical:**
- Updated `copperToPrice()` to correctly calculate gold/silver/copper breakdown
- Added level field to character sheet HTML
- Character level saved to both `/characterSheet/level` and `/level` in Firebase
- Added `addToCart()` validation using `canAccessItemByRarity()`
- Implemented cache-busting version system

**Market Access Tiers:**
- Common: Level 1+
- Uncommon: Level 3+ (+5% scarcity premium)
- Rare: Level 9+ (+5% scarcity premium)
- Very Rare: Level 13+ (+5% scarcity premium)
- Legendary: Level 17+ (+5% scarcity premium)

---

### Future Versions
- v1.22 - Next update...

---

## Quick Update Checklist
When releasing a new version:
- [ ] Update version number in all 5 locations listed above
- [ ] Update changelog in VERSION.md
- [ ] Commit changes to GitHub
- [ ] Push to main branch
- [ ] GitHub Pages will auto-deploy (~1-2 minutes)
- [ ] Clear browser cache and test
